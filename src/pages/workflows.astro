---
import BaseLayout from '../layouts/BaseLayout.astro';
---

<BaseLayout title="Automated Workflows" description="Explore the automated security workflows and game analytics processing systems">
  <div class="max-w-6xl mx-auto">
    <!-- Hero Section -->
    <div class="text-center mb-12">
      <h1 class="text-4xl md:text-5xl font-bold mb-6 bg-gradient-to-r from-blue-400 via-purple-500 to-blue-600 bg-clip-text text-transparent">
        Automated Workflows
      </h1>
      <p class="text-xl text-slate-300 mb-8 max-w-3xl mx-auto">
        This site demonstrates modern automated workflows using Cloudflare's edge computing platform.
        Real-time processing, analytics, and security automation in action.
      </p>
    </div>

    <!-- Active Workflows Section -->
    <div class="grid md:grid-cols-2 gap-8 mb-12">
      <!-- Game Score Processor -->
      <div class="bg-slate-800/50 backdrop-blur-sm border border-slate-600 rounded-xl p-8 hover:border-blue-500/50 transition-all duration-300">
        <div class="flex items-center mb-6">
          <div class="bg-blue-500/20 p-3 rounded-lg mr-4">
            <span class="text-2xl">ðŸŽ®</span>
          </div>
          <div>
            <h2 class="text-2xl font-bold text-blue-400">Game Score Processor</h2>
            <div class="flex items-center space-x-2">
              <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
              <span class="text-green-400 text-sm font-medium">Active</span>
            </div>
          </div>
        </div>
        
        <p class="text-slate-300 mb-6">
          Processes game scores in real-time, updates leaderboards, generates player analytics, 
          and maintains game statistics across all arcade games.
        </p>
        
        <div class="space-y-4">
          <div class="bg-slate-700/30 rounded-lg p-4">
            <h4 class="font-semibold text-blue-300 mb-2">Workflow Steps:</h4>
            <ul class="text-sm text-slate-300 space-y-1">
              <li>â€¢ Score validation and sanitization</li>
              <li>â€¢ Leaderboard ranking updates</li>
              <li>â€¢ Player statistics aggregation</li>
              <li>â€¢ Daily analytics generation</li>
              <li>â€¢ Achievement unlock triggers</li>
            </ul>
          </div>
          
          <div class="bg-slate-700/30 rounded-lg p-4">
            <h4 class="font-semibold text-blue-300 mb-2">Technologies:</h4>
            <div class="flex flex-wrap gap-2">
              <span class="px-2 py-1 text-xs bg-blue-500/20 text-blue-400 rounded border border-blue-400/30">Cloudflare Workers</span>
              <span class="px-2 py-1 text-xs bg-purple-500/20 text-purple-400 rounded border border-purple-400/30">KV Storage</span>
              <span class="px-2 py-1 text-xs bg-green-500/20 text-green-400 rounded border border-green-400/30">TypeScript</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Guestbook Analytics -->
      <div class="bg-slate-800/50 backdrop-blur-sm border border-slate-600 rounded-xl p-8 hover:border-purple-500/50 transition-all duration-300">
        <div class="flex items-center mb-6">
          <div class="bg-purple-500/20 p-3 rounded-lg mr-4">
            <span class="text-2xl">ðŸ’¬</span>
          </div>
          <div>
            <h2 class="text-2xl font-bold text-purple-400">Guestbook Analytics</h2>
            <div class="flex items-center space-x-2">
              <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
              <span class="text-green-400 text-sm font-medium">Active</span>
            </div>
          </div>
        </div>
        
        <p class="text-slate-300 mb-6">
          Automated processing of guestbook entries with game score verification,
          spam protection, and analytics tracking for user engagement.
        </p>
        
        <div class="space-y-4">
          <div class="bg-slate-700/30 rounded-lg p-4">
            <h4 class="font-semibold text-purple-300 mb-2">Features:</h4>
            <ul class="text-sm text-slate-300 space-y-1">
              <li>â€¢ Game score requirement verification</li>
              <li>â€¢ Turnstile CAPTCHA integration</li>
              <li>â€¢ Automated content moderation</li>
              <li>â€¢ User engagement analytics</li>
              <li>â€¢ Rate limiting and spam protection</li>
            </ul>
          </div>
          
          <div class="bg-slate-700/30 rounded-lg p-4">
            <h4 class="font-semibold text-purple-300 mb-2">Technologies:</h4>
            <div class="flex flex-wrap gap-2">
              <span class="px-2 py-1 text-xs bg-blue-500/20 text-blue-400 rounded border border-blue-400/30">D1 Database</span>
              <span class="px-2 py-1 text-xs bg-purple-500/20 text-purple-400 rounded border border-purple-400/30">Turnstile</span>
              <span class="px-2 py-1 text-xs bg-green-500/20 text-green-400 rounded border border-green-400/30">Edge Functions</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Security Workflows Section -->
    <div class="bg-slate-800/50 backdrop-blur-sm border border-slate-600 rounded-xl p-8 mb-12">
      <h2 class="text-3xl font-bold text-yellow-400 mb-6 flex items-center">
        <span class="mr-3">ðŸ”’</span>
        Security & Infrastructure Workflows
      </h2>
      
      <p class="text-slate-300 mb-8">
        Automated monitoring and infrastructure management workflows deployed in production environments.
      </p>
      
      <div class="grid lg:grid-cols-3 gap-6">
        <div class="bg-slate-700/30 rounded-lg p-6">
          <h3 class="font-bold text-yellow-300 mb-3">Rate Limiting</h3>
          <p class="text-sm text-slate-300 mb-4">
            Automatic traffic analysis and rate limiting to prevent abuse and ensure service availability.
          </p>
          <div class="flex items-center space-x-2">
            <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
            <span class="text-green-400 text-xs">Monitoring Active</span>
          </div>
        </div>
        
        <div class="bg-slate-700/30 rounded-lg p-6">
          <h3 class="font-bold text-yellow-300 mb-3">Geo-Analytics</h3>
          <p class="text-sm text-slate-300 mb-4">
            Real-time visitor location tracking and analytics for performance optimization.
          </p>
          <div class="flex items-center space-x-2">
            <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
            <span class="text-green-400 text-xs">Processing Data</span>
          </div>
        </div>
        
        <div class="bg-slate-700/30 rounded-lg p-6">
          <h3 class="font-bold text-yellow-300 mb-3">Content Management</h3>
          <p class="text-sm text-slate-300 mb-4">
            Automated content validation and header management across all pages.
          </p>
          <div class="flex items-center space-x-2">
            <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
            <span class="text-green-400 text-xs">Headers Applied</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Workflow Analytics Dashboard -->
    <div class="bg-slate-800/50 backdrop-blur-sm border border-slate-600 rounded-xl p-8">
      <h2 class="text-3xl font-bold text-blue-400 mb-6 flex items-center">
        <span class="mr-3">ðŸ“Š</span>
        Live Workflow Metrics
      </h2>
      
      <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6">
        <div class="bg-slate-700/30 rounded-lg p-6 text-center">
          <div class="text-3xl font-bold text-blue-400 mb-2" id="total-games">-</div>
          <div class="text-sm text-slate-400">Games Processed</div>
          <div class="text-xs text-green-400 mt-1">Last 24h</div>
        </div>
        
        <div class="bg-slate-700/30 rounded-lg p-6 text-center">
          <div class="text-3xl font-bold text-purple-400 mb-2" id="guestbook-entries">-</div>
          <div class="text-sm text-slate-400">Guestbook Entries</div>
          <div class="text-xs text-green-400 mt-1">Total</div>
        </div>
        
        <div class="bg-slate-700/30 rounded-lg p-6 text-center">
          <div class="text-3xl font-bold text-yellow-400 mb-2" id="security-checks">99.9%</div>
          <div class="text-sm text-slate-400">System Uptime</div>
          <div class="text-xs text-green-400 mt-1">Current</div>
        </div>
        
        <div class="bg-slate-700/30 rounded-lg p-6 text-center">
          <div class="text-3xl font-bold text-green-400 mb-2" id="response-time">~50ms</div>
          <div class="text-sm text-slate-400">Avg Response</div>
          <div class="text-xs text-green-400 mt-1">Edge Network</div>
        </div>
      </div>
      
      <div class="mt-8 text-center">
        <p class="text-slate-400 text-sm mb-4">
          All workflows run on Cloudflare's global edge network for maximum performance and reliability.
        </p>
        <div class="flex justify-center space-x-4">
          <a href="/guestbook" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors duration-200">
            Try Guestbook Workflow
          </a>
          <button onclick="launchArcadeFromButton()" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg transition-colors duration-200">
            Test Game Analytics
          </button>
        </div>
      </div>
    </div>
  </div>
</BaseLayout>

<script>
  // Load some basic analytics data
  async function loadWorkflowMetrics() {
    try {
      // Load guestbook count
      const guestbookResponse = await fetch('/api/guestbook');
      const guestbookData = await guestbookResponse.json();
      document.getElementById('guestbook-entries').textContent = guestbookData.length.toString();

      // Simulate some other metrics (in production these would come from actual analytics)
      document.getElementById('total-games').textContent = Math.floor(Math.random() * 500 + 100).toString();

    } catch (error) {
      console.error('Error loading workflow metrics:', error);
    }
  }

  // Launch arcade directly when button is clicked
  function launchArcadeFromButton() {
    // Simulate clicking the game trigger button
    const gameTrigger = document.getElementById('game-trigger');
    if (gameTrigger) {
      gameTrigger.click();
    } else {
      // Fallback if the trigger button isn't found
      alert('ðŸŽ® Click the floating controller button (ðŸŽ®) in the bottom-right corner to launch the arcade!');
    }
  }

  // Load metrics on page load
  loadWorkflowMetrics();

  // Update metrics every 30 seconds
  setInterval(loadWorkflowMetrics, 30000);
</script>
</BaseLayout>
